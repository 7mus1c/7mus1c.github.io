# 资源加载优化

## 资源压缩

控制好资源的体积，避免某个资源过大影响页面渲染或其他资源的运行.
比如说 main.js 现在过大,那么会导致页面长时间白屏,或者说一张图片过大,那么其他资源都加载运行完了,图片只展示了一半在页面上.
所以对于资源来说要进行压缩拆包等处理方式.比如把 main.js 拆分成几个 chunk.不要把所有代码一股脑都塞到 main.js 里面.
具体操作会在首屏优化里面详细介绍.

## 合理使用缓存

浏览器会对http请求过的文件进行缓存,以便下一次访问时重复去使用.提高页面的访问速度.
缓存分为协商缓存和强缓存,像一些js、 css 、图片等资源推荐使用强缓存,再配合构建工具生成文件 hash 名,在需要更新时跳过缓存.

## 优化资源加载时机

浏览器在解析 HTML 时,如果遇到一个没有任务特殊属性的script 标签,就会暂定解析,先发送网络去请求获取 js 的内容,然后让 js 引擎执行代码,当代码执行完毕后继续后续的解析.
所以这样的方式会阻塞后续内容的解析.

可以给 script 标签添加 async 和 defer 来改变加载和执行的时机,

- defer异步下载,等到整个页面在内存中正常渲染结束(DOM结构完成生成,其他脚本执行完成),才会执行.
- async也是异步下载,一旦下载完成就会中断渲染,等执行完成之后,在继续渲染

defer 是 "下载完等渲染完再执行"，async 是 "下载完就执行"；
多个 defer是按照顺序去加载, async就是随机的加载并非按照顺序去加载.

```js
<!-- defer：HTML解析后执行，保持顺序 -->
<script src="app.js" defer></script>

<!-- async：下载完立即执行，不保证顺序 -->
<script src="analytics.js" async></script>
```
按需加载也是一种优化方式,比如在页面加载时,只加载核心的资源,比如核心的 css、js 文件,然后根据用户操作加载其他资源.
比如点击按钮再加载某一个资源,那么就可以使用按需加载了.
```jsx
funciont App() {    
    return (
        <button onClick={() => import('./other.js')}>Click me</button>
    )
}
```